apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-alerts
  namespace: monitoring
data:
  argocd-alerts.yaml: |
    groups:
    - name: argocd
      interval: 30s
      rules:
      
      # Application sync failures
      - alert: ArgoCDAppOutOfSync
        expr: argocd_app_info{sync_status="OutOfSync"} == 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ArgoCD app {{ $labels.name }} is out of sync"
          description: "Application {{ $labels.name }} in namespace {{ $labels.namespace }} has been out of sync for more than 5 minutes"
      
      # Application health issues
      - alert: ArgoCDAppUnhealthy
        expr: argocd_app_info{health_status!="Healthy"} == 1
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "ArgoCD app {{ $labels.name }} is unhealthy"
          description: "Application {{ $labels.name }} health status is {{ $labels.health_status }}"
      
      # Sync failures
      - alert: ArgoCDSyncFailure
        expr: rate(argocd_app_sync_total{phase="Error"}[5m]) > 0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ArgoCD sync failures detected"
          description: "Application {{ $labels.name }} has failing syncs"
      
      # Controller errors
      - alert: ArgoCDControllerErrors
        expr: rate(argocd_app_reconcile_count{phase="Error"}[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ArgoCD controller errors increasing"
          description: "ArgoCD application controller is experiencing errors"
      
      # Repository connection issues
      - alert: ArgoCDRepoConnectionFailure
        expr: argocd_git_request_total{request_type="ls-remote",status_code!~"2.."} > 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "ArgoCD repository connection failures"
          description: "ArgoCD is unable to connect to git repository"
